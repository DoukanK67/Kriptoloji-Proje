<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <title>Şifreleme Aracı (Python) - Çoklu Şifreleme Algoritmaları</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  </head>
  <body>
    <div class="app">
      <header class="header">
        <h1>Şifreleme Aracı (Python)</h1>
        <p>Sezar, Rail Fence, Vigenere, Vernam, Playfair, Route, Affine, Hill Cipher, Columnar, AES, DES ve RSA algoritmalarını Python ile sunucu tarafında çalıştırır.</p>
      </header>

      <main class="main">
        <section class="card">
          <div class="card-header">
            <h2>Girdi</h2>
          </div>
          <div class="card-body">
            <form method="post" id="cipherForm">
              <label class="field">
                <span>Metin</span>
                <textarea
                  name="text"
                  rows="5"
                  placeholder="Şifrelenecek veya çözülecek metni buraya yazın..."
                >{{ state.text }}</textarea>
              </label>

              <label class="field">
                <span>Algoritma</span>
                <select name="algorithm" id="algorithm">
                  <option value="caesar" {% if state.algorithm == "caesar" %}selected{% endif %}>
                    Sezar Şifrelemesi
                  </option>
                  <option value="railFence" {% if state.algorithm == "railFence" %}selected{% endif %}>
                    Rail Fence Şifrelemesi
                  </option>
                  <option value="vigenere" {% if state.algorithm == "vigenere" %}selected{% endif %}>
                    Vigenere Şifrelemesi
                  </option>
                  <option value="vernam" {% if state.algorithm == "vernam" %}selected{% endif %}>
                    Vernam Şifrelemesi
                  </option>
                  <option value="playfair" {% if state.algorithm == "playfair" %}selected{% endif %}>
                    Playfair Şifrelemesi
                  </option>
                  <option value="route" {% if state.algorithm == "route" %}selected{% endif %}>
                    Route Şifrelemesi
                  </option>
                  <option value="affine" {% if state.algorithm == "affine" %}selected{% endif %}>
                    Affine Şifrelemesi
                  </option>
                  <option value="hill" {% if state.algorithm == "hill" %}selected{% endif %}>
                    Hill Cipher
                  </option>
                  <option value="columnar" {% if state.algorithm == "columnar" %}selected{% endif %}>
                    Columnar Transposition
                  </option>
                  <option value="aes" {% if state.algorithm == "aes" %}selected{% endif %}>
                    AES Şifreleme
                  </option>
                  <option value="des" {% if state.algorithm == "des" %}selected{% endif %}>
                    DES Şifreleme
                  </option>
                  <option value="rsa" {% if state.algorithm == "rsa" %}selected{% endif %}>
                    RSA Şifreleme
                  </option>
                </select>
              </label>

              <div
                class="algorithm-options"
                id="caesarOptions"
                {% if state.algorithm != "caesar" %}style="display:none"{% endif %}
              >
                <label class="field inline">
                  <span>Kaydırma (shift)</span>
                  <input
                    type="number"
                    name="caesarShift"
                    value="{{ state.caesar_shift }}"
                    min="-25"
                    max="25"
                  />
                </label>
              </div>

              <div
                class="algorithm-options"
                id="railFenceOptions"
                {% if state.algorithm != "railFence" %}style="display:none"{% endif %}
              >
                <label class="field inline">
                  <span>Katman (rail) sayısı</span>
                  <input
                    type="number"
                    name="railRails"
                    value="{{ state.rail_rails }}"
                    min="2"
                    max="20"
                  />
                </label>
              </div>

              <div
                class="algorithm-options"
                id="vigenereOptions"
                {% if state.algorithm != "vigenere" %}style="display:none"{% endif %}
              >
                <label class="field">
                  <span>Anahtar Kelime</span>
                  <input
                    type="text"
                    name="vigenereKey"
                    value="{{ state.vigenere_key }}"
                    placeholder="Anahtar kelime girin..."
                  />
                </label>
              </div>

              <div
                class="algorithm-options"
                id="vernamOptions"
                {% if state.algorithm != "vernam" %}style="display:none"{% endif %}
              >
                <label class="field">
                  <span>Anahtar (One-Time Pad)</span>
                  <input
                    type="text"
                    name="vernamKey"
                    value="{{ state.vernam_key }}"
                    placeholder="Anahtar girin..."
                  />
                </label>
              </div>

              <div
                class="algorithm-options"
                id="playfairOptions"
                {% if state.algorithm != "playfair" %}style="display:none"{% endif %}
              >
                <label class="field">
                  <span>Anahtar Kelime</span>
                  <input
                    type="text"
                    name="playfairKey"
                    value="{{ state.playfair_key }}"
                    placeholder="Anahtar kelime girin..."
                  />
                </label>
              </div>

              <div
                class="algorithm-options"
                id="routeOptions"
                {% if state.algorithm != "route" %}style="display:none"{% endif %}
              >
                <label class="field inline">
                  <span>Satır Sayısı</span>
                  <input
                    type="number"
                    name="routeRows"
                    value="{{ state.route_rows }}"
                    min="2"
                    max="20"
                  />
                </label>
                <label class="field inline">
                  <span>Sütun Sayısı</span>
                  <input
                    type="number"
                    name="routeCols"
                    value="{{ state.route_cols }}"
                    min="2"
                    max="20"
                  />
                </label>
              </div>

              <div
                class="algorithm-options"
                id="affineOptions"
                {% if state.algorithm != "affine" %}style="display:none"{% endif %}
              >
                <label class="field inline">
                  <span>a (1-25, 26 ile aralarında asal olmalı)</span>
                  <input
                    type="number"
                    name="affineA"
                    value="{{ state.affine_a }}"
                    min="1"
                    max="25"
                  />
                </label>
                <label class="field inline">
                  <span>b (0-25)</span>
                  <input
                    type="number"
                    name="affineB"
                    value="{{ state.affine_b }}"
                    min="0"
                    max="25"
                  />
                </label>
              </div>

              <div
                class="algorithm-options"
                id="hillOptions"
                {% if state.algorithm != "hill" %}style="display:none"{% endif %}
              >
                <label class="field">
                  <span>Anahtar Kelime</span>
                  <input
                    type="text"
                    name="hillKey"
                    value="{{ state.hill_key }}"
                    placeholder="Anahtar kelime girin..."
                  />
                </label>
                <label class="field inline">
                  <span>Matris Boyutu</span>
                  <select name="hillSize">
                    <option value="2" {% if state.hill_size == 2 %}selected{% endif %}>2x2</option>
                    <option value="3" {% if state.hill_size == 3 %}selected{% endif %}>3x3</option>
                  </select>
                </label>
              </div>

              <div
                class="algorithm-options"
                id="columnarOptions"
                {% if state.algorithm != "columnar" %}style="display:none"{% endif %}
              >
                <label class="field">
                  <span>Anahtar Kelime</span>
                  <input
                    type="text"
                    name="columnarKey"
                    value="{{ state.columnar_key }}"
                    placeholder="Anahtar kelime girin..."
                  />
                </label>
              </div>

              <div
                class="algorithm-options"
                id="aesOptions"
                {% if state.algorithm != "aes" %}style="display:none"{% endif %}
              >
                <label class="field">
                  <span>Anahtar</span>
                  <input
                    type="text"
                    name="aesKey"
                    value="{{ state.aes_key }}"
                    placeholder="AES anahtarı girin (16, 24 veya 32 karakter önerilir)..."
                  />
                </label>
                <div class="mode-toggle">
                  <label>
                    <input
                      type="radio"
                      name="aesUseLibrary"
                      value="true"
                      {% if state.aes_use_library %}checked{% endif %}
                    />
                    Kütüphaneli (pycryptodome)
                  </label>
                  <label>
                    <input
                      type="radio"
                      name="aesUseLibrary"
                      value="false"
                      {% if not state.aes_use_library %}checked{% endif %}
                    />
                    Kütüphanesiz (manuel)
                  </label>
                </div>
              </div>

              <div
                class="algorithm-options"
                id="desOptions"
                {% if state.algorithm != "des" %}style="display:none"{% endif %}
              >
                <label class="field">
                  <span>Anahtar (8 karakter)</span>
                  <input
                    type="text"
                    name="desKey"
                    value="{{ state.des_key }}"
                    placeholder="DES anahtarı girin (8 karakter)..."
                    maxlength="8"
                  />
                </label>
                <div class="mode-toggle">
                  <label>
                    <input
                      type="radio"
                      name="desUseLibrary"
                      value="true"
                      {% if state.des_use_library %}checked{% endif %}
                    />
                    Kütüphaneli (pycryptodome)
                  </label>
                  <label>
                    <input
                      type="radio"
                      name="desUseLibrary"
                      value="false"
                      {% if not state.des_use_library %}checked{% endif %}
                    />
                    Kütüphanesiz (manuel)
                  </label>
                </div>
              </div>

              <div
                class="algorithm-options"
                id="rsaOptions"
                {% if state.algorithm != "rsa" %}style="display:none"{% endif %}
              >
                <label class="field inline">
                  <span>Anahtar Boyutu (bit)</span>
                  <input
                    type="number"
                    name="rsaKeySize"
                    value="{{ state.rsa_key_size }}"
                    min="512"
                    max="4096"
                    step="512"
                  />
                </label>
                <label class="field">
                  <span>Public Key (Şifreleme için)</span>
                  <textarea
                    name="rsaPublicKey"
                    rows="4"
                    placeholder="Public key'i buraya yapıştırın veya 'Anahtar Oluştur' butonuna basın..."
                  >{{ state.rsa_public_key }}</textarea>
                </label>
                <label class="field">
                  <span>Private Key (Deşifreleme için)</span>
                  <textarea
                    name="rsaPrivateKey"
                    rows="4"
                    placeholder="Private key'i buraya yapıştırın..."
                  >{{ state.rsa_private_key }}</textarea>
                </label>
                <div class="mode-toggle">
                  <label>
                    <input
                      type="radio"
                      name="rsaUseLibrary"
                      value="true"
                      {% if state.rsa_use_library %}checked{% endif %}
                    />
                    Kütüphaneli (pycryptodome)
                  </label>
                  <label>
                    <input
                      type="radio"
                      name="rsaUseLibrary"
                      value="false"
                      {% if not state.rsa_use_library %}checked{% endif %}
                    />
                    Kütüphanesiz (manuel)
                  </label>
                </div>
                <button type="button" id="generateRsaKeysBtn" class="secondary" style="margin-top: 10px;">
                  Anahtar Çifti Oluştur
                </button>
              </div>

              <div class="mode-toggle">
                <label>
                  <input
                    type="radio"
                    name="mode"
                    value="encrypt"
                    {% if state.mode == "encrypt" %}checked{% endif %}
                  />
                  Şifrele
                </label>
                <label>
                  <input
                    type="radio"
                    name="mode"
                    value="decrypt"
                    {% if state.mode == "decrypt" %}checked{% endif %}
                  />
                  Deşifre Et
                </label>
              </div>

              <div class="actions">
                <button type="submit" id="runBtn">Çalıştır</button>
                <button type="button" id="clearBtn" class="secondary">Temizle</button>
              </div>
            </form>
          </div>
        </section>

        <section class="card">
          <div class="card-header">
            <h2>Sonuç</h2>
          </div>
          <div class="card-body">
            <label class="field">
              <span>Çıktı Metni</span>
              <textarea
                id="outputText"
                rows="5"
                readonly
                placeholder="Sonuç burada görünecek..."
              >{{ state.output }}</textarea>
            </label>
            <button id="copyBtn" class="secondary full" type="button">Çıktıyı Kopyala</button>
            <p
              class="helper"
              id="status"
              style="color: {% if state.is_error %}#f87171{% else %}#9ca3af{% endif %}"
            >
              {{ state.status }}
            </p>
          </div>
        </section>
      </main>

      <footer class="footer">
        <small>
          Sezar: her harfi alfabe üzerinde kaydırır. Rail Fence: harfleri zikzak şekilde katmanlara dağıtarak yer değiştirir.
          Vigenere: anahtar kelime ile harfleri kaydırır. Vernam: XOR tabanlı şifreleme. Playfair: 5x5 grid kullanır.
          Route: metni grid'e yerleştirip spiral rotada okur. Affine: (ax+b) mod 26 formülü ile şifreler.
          Hill Cipher: matris tabanlı blok şifreleme. Columnar: metni matrise yerleştirip sütun sırasına göre okur.
          AES: gelişmiş şifreleme standardı (kütüphaneli/kütüphanesiz). DES: veri şifreleme standardı (kütüphaneli/kütüphanesiz).
          RSA: asimetrik şifreleme algoritması (public/private key çifti kullanır, kütüphaneli/kütüphanesiz).
        </small>
      </footer>
    </div>

    <script>
      // Algoritma seçimine göre seçenek alanlarını göster/gizle
      const algorithmSelect = document.getElementById("algorithm");
      const caesarOptions = document.getElementById("caesarOptions");
      const railFenceOptions = document.getElementById("railFenceOptions");
      const vigenereOptions = document.getElementById("vigenereOptions");
      const vernamOptions = document.getElementById("vernamOptions");
      const playfairOptions = document.getElementById("playfairOptions");
      const routeOptions = document.getElementById("routeOptions");
      const affineOptions = document.getElementById("affineOptions");
      const hillOptions = document.getElementById("hillOptions");
      const columnarOptions = document.getElementById("columnarOptions");
      const aesOptions = document.getElementById("aesOptions");
      const desOptions = document.getElementById("desOptions");
      const rsaOptions = document.getElementById("rsaOptions");
      const clearBtn = document.getElementById("clearBtn");
      const generateRsaKeysBtn = document.getElementById("generateRsaKeysBtn");
      const outputText = document.getElementById("outputText");
      const statusEl = document.getElementById("status");
      const copyBtn = document.getElementById("copyBtn");
      const form = document.getElementById("cipherForm");

      function hideAllOptions() {
        caesarOptions.style.display = "none";
        railFenceOptions.style.display = "none";
        vigenereOptions.style.display = "none";
        vernamOptions.style.display = "none";
        playfairOptions.style.display = "none";
        routeOptions.style.display = "none";
        affineOptions.style.display = "none";
        hillOptions.style.display = "none";
        columnarOptions.style.display = "none";
        aesOptions.style.display = "none";
        desOptions.style.display = "none";
        rsaOptions.style.display = "none";
      }

      algorithmSelect.addEventListener("change", () => {
        const val = algorithmSelect.value;
        hideAllOptions();
        
        if (val === "caesar") {
          caesarOptions.style.display = "";
        } else if (val === "railFence") {
          railFenceOptions.style.display = "";
        } else if (val === "vigenere") {
          vigenereOptions.style.display = "";
        } else if (val === "vernam") {
          vernamOptions.style.display = "";
        } else if (val === "playfair") {
          playfairOptions.style.display = "";
        } else if (val === "route") {
          routeOptions.style.display = "";
        } else if (val === "affine") {
          affineOptions.style.display = "";
        } else if (val === "hill") {
          hillOptions.style.display = "";
        } else if (val === "columnar") {
          columnarOptions.style.display = "";
        } else if (val === "aes") {
          aesOptions.style.display = "";
        } else if (val === "des") {
          desOptions.style.display = "";
        } else if (val === "rsa") {
          rsaOptions.style.display = "";
        }
      });

      // RSA anahtar oluştur butonu
      if (generateRsaKeysBtn) {
        generateRsaKeysBtn.addEventListener("click", async () => {
          const keySize = document.querySelector('input[name="rsaKeySize"]').value || "2048";
          const useLibrary = document.querySelector('input[name="rsaUseLibrary"]:checked').value === "true";
          
          const formData = new FormData();
          formData.append("keySize", keySize);
          formData.append("useLibrary", useLibrary);
          
          try {
            generateRsaKeysBtn.disabled = true;
            generateRsaKeysBtn.textContent = "Oluşturuluyor...";
            
            const response = await fetch("/generate-rsa-keys", {
              method: "POST",
              body: formData
            });
            
            const data = await response.json();
            
            if (data.success) {
              document.querySelector('textarea[name="rsaPublicKey"]').value = data.public_key;
              document.querySelector('textarea[name="rsaPrivateKey"]').value = data.private_key;
              statusEl.textContent = "RSA anahtar çifti başarıyla oluşturuldu.";
              statusEl.style.color = "#9ca3af";
            } else {
              statusEl.textContent = `Anahtar oluşturma hatası: ${data.error}`;
              statusEl.style.color = "#f87171";
            }
          } catch (error) {
            statusEl.textContent = `Anahtar oluşturma hatası: ${error.message}`;
            statusEl.style.color = "#f87171";
          } finally {
            generateRsaKeysBtn.disabled = false;
            generateRsaKeysBtn.textContent = "Anahtar Çifti Oluştur";
          }
        });
      }

      // Sayfa yüklendiğinde doğru seçeneği göster
      window.addEventListener("DOMContentLoaded", () => {
        algorithmSelect.dispatchEvent(new Event("change"));
      });

      clearBtn.addEventListener("click", () => {
        form.reset();
        outputText.value = "";
        statusEl.textContent = "";
      });

      copyBtn.addEventListener("click", () => {
        const text = outputText.value;
        if (!text) {
          statusEl.textContent = "Kopyalanacak çıktı yok.";
          statusEl.style.color = "#f87171";
          return;
        }
        navigator.clipboard
          .writeText(text)
          .then(() => {
            statusEl.textContent = "Çıktı panoya kopyalandı.";
            statusEl.style.color = "#9ca3af";
          })
          .catch(() => {
            statusEl.textContent = "Kopyalama başarısız oldu.";
            statusEl.style.color = "#f87171";
          });
      });
    </script>
  </body>
</html>


