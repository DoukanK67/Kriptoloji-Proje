<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <title>Şifreleme Aracı (Python) - Çoklu Şifreleme Algoritmaları</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  </head>
  <body>
    <div class="app">
      <header class="header">
        <h1>Şifreleme Aracı (Python)</h1>
        <p>Sezar, Rail Fence, Vigenere, Vernam, Playfair, Route, Affine, Hill Cipher ve Columnar algoritmalarını Python ile sunucu tarafında çalıştırır.</p>
      </header>

      <main class="main">
        <section class="card">
          <div class="card-header">
            <h2>Girdi</h2>
          </div>
          <div class="card-body">
            <form method="post" id="cipherForm">
              <label class="field">
                <span>Metin</span>
                <textarea
                  name="text"
                  rows="5"
                  placeholder="Şifrelenecek veya çözülecek metni buraya yazın..."
                >{{ state.text }}</textarea>
              </label>

              <label class="field">
                <span>Algoritma</span>
                <select name="algorithm" id="algorithm">
                  <option value="caesar" {% if state.algorithm == "caesar" %}selected{% endif %}>
                    Sezar Şifrelemesi
                  </option>
                  <option value="railFence" {% if state.algorithm == "railFence" %}selected{% endif %}>
                    Rail Fence Şifrelemesi
                  </option>
                  <option value="vigenere" {% if state.algorithm == "vigenere" %}selected{% endif %}>
                    Vigenere Şifrelemesi
                  </option>
                  <option value="vernam" {% if state.algorithm == "vernam" %}selected{% endif %}>
                    Vernam Şifrelemesi
                  </option>
                  <option value="playfair" {% if state.algorithm == "playfair" %}selected{% endif %}>
                    Playfair Şifrelemesi
                  </option>
                  <option value="route" {% if state.algorithm == "route" %}selected{% endif %}>
                    Route Şifrelemesi
                  </option>
                  <option value="affine" {% if state.algorithm == "affine" %}selected{% endif %}>
                    Affine Şifrelemesi
                  </option>
                  <option value="hill" {% if state.algorithm == "hill" %}selected{% endif %}>
                    Hill Cipher
                  </option>
                  <option value="columnar" {% if state.algorithm == "columnar" %}selected{% endif %}>
                    Columnar Transposition
                  </option>
                </select>
              </label>

              <div
                class="algorithm-options"
                id="caesarOptions"
                {% if state.algorithm != "caesar" %}style="display:none"{% endif %}
              >
                <label class="field inline">
                  <span>Kaydırma (shift)</span>
                  <input
                    type="number"
                    name="caesarShift"
                    value="{{ state.caesar_shift }}"
                    min="-25"
                    max="25"
                  />
                </label>
              </div>

              <div
                class="algorithm-options"
                id="railFenceOptions"
                {% if state.algorithm != "railFence" %}style="display:none"{% endif %}
              >
                <label class="field inline">
                  <span>Katman (rail) sayısı</span>
                  <input
                    type="number"
                    name="railRails"
                    value="{{ state.rail_rails }}"
                    min="2"
                    max="20"
                  />
                </label>
              </div>

              <div
                class="algorithm-options"
                id="vigenereOptions"
                {% if state.algorithm != "vigenere" %}style="display:none"{% endif %}
              >
                <label class="field">
                  <span>Anahtar Kelime</span>
                  <input
                    type="text"
                    name="vigenereKey"
                    value="{{ state.vigenere_key }}"
                    placeholder="Anahtar kelime girin..."
                  />
                </label>
              </div>

              <div
                class="algorithm-options"
                id="vernamOptions"
                {% if state.algorithm != "vernam" %}style="display:none"{% endif %}
              >
                <label class="field">
                  <span>Anahtar (One-Time Pad)</span>
                  <input
                    type="text"
                    name="vernamKey"
                    value="{{ state.vernam_key }}"
                    placeholder="Anahtar girin..."
                  />
                </label>
              </div>

              <div
                class="algorithm-options"
                id="playfairOptions"
                {% if state.algorithm != "playfair" %}style="display:none"{% endif %}
              >
                <label class="field">
                  <span>Anahtar Kelime</span>
                  <input
                    type="text"
                    name="playfairKey"
                    value="{{ state.playfair_key }}"
                    placeholder="Anahtar kelime girin..."
                  />
                </label>
              </div>

              <div
                class="algorithm-options"
                id="routeOptions"
                {% if state.algorithm != "route" %}style="display:none"{% endif %}
              >
                <label class="field inline">
                  <span>Satır Sayısı</span>
                  <input
                    type="number"
                    name="routeRows"
                    value="{{ state.route_rows }}"
                    min="2"
                    max="20"
                  />
                </label>
                <label class="field inline">
                  <span>Sütun Sayısı</span>
                  <input
                    type="number"
                    name="routeCols"
                    value="{{ state.route_cols }}"
                    min="2"
                    max="20"
                  />
                </label>
              </div>

              <div
                class="algorithm-options"
                id="affineOptions"
                {% if state.algorithm != "affine" %}style="display:none"{% endif %}
              >
                <label class="field inline">
                  <span>a (1-25, 26 ile aralarında asal olmalı)</span>
                  <input
                    type="number"
                    name="affineA"
                    value="{{ state.affine_a }}"
                    min="1"
                    max="25"
                  />
                </label>
                <label class="field inline">
                  <span>b (0-25)</span>
                  <input
                    type="number"
                    name="affineB"
                    value="{{ state.affine_b }}"
                    min="0"
                    max="25"
                  />
                </label>
              </div>

              <div
                class="algorithm-options"
                id="hillOptions"
                {% if state.algorithm != "hill" %}style="display:none"{% endif %}
              >
                <label class="field">
                  <span>Anahtar Kelime</span>
                  <input
                    type="text"
                    name="hillKey"
                    value="{{ state.hill_key }}"
                    placeholder="Anahtar kelime girin..."
                  />
                </label>
                <label class="field inline">
                  <span>Matris Boyutu</span>
                  <select name="hillSize">
                    <option value="2" {% if state.hill_size == 2 %}selected{% endif %}>2x2</option>
                    <option value="3" {% if state.hill_size == 3 %}selected{% endif %}>3x3</option>
                  </select>
                </label>
              </div>

              <div
                class="algorithm-options"
                id="columnarOptions"
                {% if state.algorithm != "columnar" %}style="display:none"{% endif %}
              >
                <label class="field">
                  <span>Anahtar Kelime</span>
                  <input
                    type="text"
                    name="columnarKey"
                    value="{{ state.columnar_key }}"
                    placeholder="Anahtar kelime girin..."
                  />
                </label>
              </div>

              <div class="mode-toggle">
                <label>
                  <input
                    type="radio"
                    name="mode"
                    value="encrypt"
                    {% if state.mode == "encrypt" %}checked{% endif %}
                  />
                  Şifrele
                </label>
                <label>
                  <input
                    type="radio"
                    name="mode"
                    value="decrypt"
                    {% if state.mode == "decrypt" %}checked{% endif %}
                  />
                  Deşifre Et
                </label>
              </div>

              <div class="actions">
                <button type="submit" id="runBtn">Çalıştır</button>
                <button type="button" id="clearBtn" class="secondary">Temizle</button>
              </div>
            </form>
          </div>
        </section>

        <section class="card">
          <div class="card-header">
            <h2>Sonuç</h2>
          </div>
          <div class="card-body">
            <label class="field">
              <span>Çıktı Metni</span>
              <textarea
                id="outputText"
                rows="5"
                readonly
                placeholder="Sonuç burada görünecek..."
              >{{ state.output }}</textarea>
            </label>
            <button id="copyBtn" class="secondary full" type="button">Çıktıyı Kopyala</button>
            <p
              class="helper"
              id="status"
              style="color: {% if state.is_error %}#f87171{% else %}#9ca3af{% endif %}"
            >
              {{ state.status }}
            </p>
          </div>
        </section>
      </main>

      <footer class="footer">
        <small>
          Sezar: her harfi alfabe üzerinde kaydırır. Rail Fence: harfleri zikzak şekilde katmanlara dağıtarak yer değiştirir.
          Vigenere: anahtar kelime ile harfleri kaydırır. Vernam: XOR tabanlı şifreleme. Playfair: 5x5 grid kullanır.
          Route: metni grid'e yerleştirip spiral rotada okur. Affine: (ax+b) mod 26 formülü ile şifreler.
          Hill Cipher: matris tabanlı blok şifreleme. Columnar: metni matrise yerleştirip sütun sırasına göre okur.
        </small>
      </footer>
    </div>

    <script>
      // Algoritma seçimine göre seçenek alanlarını göster/gizle
      const algorithmSelect = document.getElementById("algorithm");
      const caesarOptions = document.getElementById("caesarOptions");
      const railFenceOptions = document.getElementById("railFenceOptions");
      const vigenereOptions = document.getElementById("vigenereOptions");
      const vernamOptions = document.getElementById("vernamOptions");
      const playfairOptions = document.getElementById("playfairOptions");
      const routeOptions = document.getElementById("routeOptions");
      const affineOptions = document.getElementById("affineOptions");
      const hillOptions = document.getElementById("hillOptions");
      const columnarOptions = document.getElementById("columnarOptions");
      const clearBtn = document.getElementById("clearBtn");
      const outputText = document.getElementById("outputText");
      const statusEl = document.getElementById("status");
      const copyBtn = document.getElementById("copyBtn");
      const form = document.getElementById("cipherForm");

      function hideAllOptions() {
        caesarOptions.style.display = "none";
        railFenceOptions.style.display = "none";
        vigenereOptions.style.display = "none";
        vernamOptions.style.display = "none";
        playfairOptions.style.display = "none";
        routeOptions.style.display = "none";
        affineOptions.style.display = "none";
        hillOptions.style.display = "none";
        columnarOptions.style.display = "none";
      }

      algorithmSelect.addEventListener("change", () => {
        const val = algorithmSelect.value;
        hideAllOptions();
        
        if (val === "caesar") {
          caesarOptions.style.display = "";
        } else if (val === "railFence") {
          railFenceOptions.style.display = "";
        } else if (val === "vigenere") {
          vigenereOptions.style.display = "";
        } else if (val === "vernam") {
          vernamOptions.style.display = "";
        } else if (val === "playfair") {
          playfairOptions.style.display = "";
        } else if (val === "route") {
          routeOptions.style.display = "";
        } else if (val === "affine") {
          affineOptions.style.display = "";
        } else if (val === "hill") {
          hillOptions.style.display = "";
        } else if (val === "columnar") {
          columnarOptions.style.display = "";
        }
      });

      // Sayfa yüklendiğinde doğru seçeneği göster
      window.addEventListener("DOMContentLoaded", () => {
        algorithmSelect.dispatchEvent(new Event("change"));
      });

      clearBtn.addEventListener("click", () => {
        form.reset();
        outputText.value = "";
        statusEl.textContent = "";
      });

      copyBtn.addEventListener("click", () => {
        const text = outputText.value;
        if (!text) {
          statusEl.textContent = "Kopyalanacak çıktı yok.";
          statusEl.style.color = "#f87171";
          return;
        }
        navigator.clipboard
          .writeText(text)
          .then(() => {
            statusEl.textContent = "Çıktı panoya kopyalandı.";
            statusEl.style.color = "#9ca3af";
          })
          .catch(() => {
            statusEl.textContent = "Kopyalama başarısız oldu.";
            statusEl.style.color = "#f87171";
          });
      });
    </script>
  </body>
</html>


